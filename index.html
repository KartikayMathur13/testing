<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chicken Chase Game</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; height: 100vh; display: flex; justify-content: center; align-items: center; background-color: #000; }
        #game-container { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        const RARITY = { COMMON: 0.001, UNCOMMON: 0.0000005, RARE: 0.00000000004 };

        class ChickenChaseGame extends Phaser.Scene {
            constructor() {
                super('ChickenChaseGame');
                this.gameState = {
                    distance: 0,
                    paused: false,
                    musicOn: true,
                    soundOn: true,
                    volume: 1,
                    chicken: { poweredUp: false, powerUpCount: 0 },
                    hearts: 5,
                    shieldActive: false,
                    powerUps: [],
                    timeSinceLastDamage: 0,
                    gameOver: false,
                    chickenBaseSpeed: 300,
                    enemyBaseSpeed: 250,
                    maxPowerUps: 3,
                };
            }

            preload() {
                this.load.image('background', 'assets/background.png');
                this.load.image('ground', 'assets/ground.png');
                this.load.image('chicken', 'assets/chicken.png');
                this.load.image('chicken_powered', 'assets/chicken_powered.png');
                this.load.image('enemy', 'assets/enemy.png');
                this.load.image('magic-potion', 'assets/magic-potion.png');
                this.load.image('health-potion', 'assets/health-potion.png');
                this.load.image('shield', 'assets/shield.png');
                this.load.image('projectile', 'assets/projectile.png');
                this.load.image('bird_flying', 'assets/bird_flying.png');
                this.load.image('heart', 'assets/heart01.png');
                this.load.image('spike', 'assets/spike.png');
                this.load.audio('background_music', 'assets/background_music.mp3');
                this.load.audio('jump_sound', 'assets/jump_sound.mp3');
                this.load.audio('hit_sound', 'assets/hit_sound.mp3');
                this.load.audio('powerup_sound', 'assets/powerup_sound.mp3');
                this.load.audio('projectile_sound', 'assets/projectile_sound.mp3');
            }

            create() {
                this.createBackground();
                this.createGround();
                this.createChicken();
                this.createEnemy();
                this.createPowerUps();
                this.createUI();
                this.createSounds();
                this.createControls();

                this.physics.add.collider(this.chicken, this.groundGroup);
                this.physics.add.overlap(this.chicken, this.powerUpGroup, this.collectPowerUp, null, this);
                this.physics.add.overlap(this.chicken, this.enemy, this.damageChicken, null, this);

                this.time.addEvent({ delay: 100, callback: this.updateDistance, callbackScope: this, loop: true });
                this.time.addEvent({ delay: 2000, callback: this.shootProjectile, callbackScope: this, loop: true });
            }

            update() {
                if (this.gameState.paused || this.gameState.gameOver) return;

                this.updateBackgroundAndGround();
                this.updateChickenPosition();
                this.updateEnemyPosition();
                this.updatePowerUps();
                this.updateProjectiles();
                this.updateGameSpeed();

                this.gameState.timeSinceLastDamage += this.game.loop.delta;
            }

            createBackground() {
                this.bg = this.add.tileSprite(0, 0, this.cameras.main.width, this.cameras.main.height, 'background').setOrigin(0);
            }

            createGround() {
                this.groundGroup = this.physics.add.staticGroup();
                this.ground = this.groundGroup.create(0, this.cameras.main.height, 'ground').setOrigin(0, 1).setScale(2);
                this.ground.refreshBody();
            }

            createChicken() {
                this.chicken = this.physics.add.sprite(this.cameras.main.width * 0.2, this.cameras.main.height - 200, 'chicken');
                this.chicken.setCollideWorldBounds(true);
                this.chicken.body.setGravityY(1000);
            }

            createEnemy() {
                this.enemy = this.physics.add.sprite(this.cameras.main.width * 0.1, this.cameras.main.height - 200, 'enemy');
                this.enemy.setCollideWorldBounds(true);
            }

            createPowerUps() {
                this.powerUpGroup = this.physics.add.group();
                ['magic-potion', 'health-potion', 'shield', 'spike'].forEach(type => {
                    this.powerUpGroup.create(this.cameras.main.width + Phaser.Math.Between(100, 1000), Phaser.Math.Between(100, this.cameras.main.height - 200), type);
                });
            }

            createUI() {
                this.distanceText = this.add.text(this.cameras.main.width / 2, 20, 'Distance: 0m', { fontSize: '24px', fill: '#fff' }).setOrigin(0.5, 0);
                this.healthBar = this.add.group();
                this.updateHealthBar();
                this.powerUpIndicators = this.add.group();
            }

            createSounds() {
                this.backgroundMusic = this.sound.add('background_music', { loop: true, volume: this.gameState.volume });
                this.jumpSound = this.sound.add('jump_sound', { volume: this.gameState.volume });
                this.hitSound = this.sound.add('hit_sound', { volume: this.gameState.volume });
                this.powerUpSound = this.sound.add('powerup_sound', { volume: this.gameState.volume });
                this.projectileSound = this.sound.add('projectile_sound', { volume: this.gameState.volume });
                if (this.gameState.musicOn) this.backgroundMusic.play();
            }

            createControls() {
                this.input.keyboard.on('keydown-SPACE', this.jump, this);
                this.input.on('pointerdown', this.jump, this);
                this.input.keyboard.on('keydown-ESC', this.togglePause, this);
            }

            updateDistance() {
                this.gameState.distance += 0.5;
                this.distanceText.setText(`Distance: ${Math.floor(this.gameState.distance)}m`);
            }

            updateBackgroundAndGround() {
                this.bg.tilePositionX += 0.5;
                this.ground.x -= 2;
                if (this.ground.x <= -this.ground.width / 2) {
                    this.ground.x = 0;
                }
            }

            updateChickenPosition() {
                if (this.chicken.body.touching.down) {
                    this.chicken.setVelocityX(0);
                }
            }

            updateEnemyPosition() {
                const targetX = this.cameras.main.width * 0.1;
                const distance = targetX - this.enemy.x;
                this.enemy.setVelocityX(distance * 0.1);
            }

            updatePowerUps() {
                this.powerUpGroup.children.entries.forEach(powerUp => {
                    powerUp.x -= 2;
                    if (powerUp.x < -powerUp.width) {
                        this.respawnPowerUp(powerUp);
                    }
                });
            }

            updateProjectiles() {
                this.projectiles.children.entries.forEach(projectile => {
                    projectile.x += 5;
                    if (projectile.x > this.cameras.main.width) {
                        projectile.destroy();
                    }
                });
            }

            updateGameSpeed() {
                const baseSpeed = 2.5;
                const maxSpeedIncrease = 25;
                const speedIncreaseRate = 0.0001;
                const speedIncrease = Math.min(this.gameState.distance * speedIncreaseRate, maxSpeedIncrease);
                const currentSpeed = baseSpeed + speedIncrease;
                this.ground.body.velocity.x = -currentSpeed * 100;
                this.enemy.body.velocity.x = -(currentSpeed - 1) * 100;
                this.powerUpGroup.setVelocityX(-currentSpeed * 100);
            }

            jump() {
                if (this.chicken.body.touching.down) {
                    this.chicken.setVelocityY(-600);
                    if (this.gameState.soundOn) this.jumpSound.play();
                }
            }

            togglePause() {
                this.gameState.paused = !this.gameState.paused;
                if (this.gameState.paused) {
                    this.backgroundMusic.pause();
                    this.scene.pause();
                    // Show pause menu
                } else {
                    if (this.gameState.musicOn) this.backgroundMusic.resume();
                    this.scene.resume();
                    // Hide pause menu
                }
            }

            collectPowerUp(chicken, powerUp) {
                switch (powerUp.texture.key) {
                    case 'magic-potion':
                        this.powerUpChicken();
                        break;
                    case 'health-potion':
                        this.healChicken();
                        break;
                    case 'shield':
                        this.activateShield();
                        break;
                    case 'spike':
                        this.damageChicken();
                        break;
                }
                this.respawnPowerUp(powerUp);
            }

            powerUpChicken() {
                if (this.gameState.chicken.powerUpCount < this.gameState.maxPowerUps) {
                    this.gameState.chicken.powerUpCount++;
                    this.gameState.chicken.poweredUp = true;
                    this.chicken.setTexture('chicken_powered');
                    this.chicken.setScale(1.2);
                    if (this.gameState.soundOn) this.powerUpSound.play();
                    this.gameState.powerUps.push({ type: 'magic-potion', duration: 10000, startTime: this.time.now });
                    this.updatePowerUpIndicators();
                }
            }

            healChicken() {
                if (this.gameState.hearts < 5) {
                    this.gameState.hearts++;
                    this.updateHealthBar();
                    if (this.gameState.soundOn) this.powerUpSound.play();
                }
            }

            activateShield() {
                this.gameState.shieldActive = true;
                if (this.gameState.soundOn) this.powerUpSound.play();
                this.gameState.powerUps.push({ type: 'shield', duration: 5000, startTime: this.time.now });
                this.updatePowerUpIndicators();
            }

            damageChicken() {
                if (this.gameState.shieldActive) {
                    this.gameState.shieldActive = false;
                    this.gameState.powerUps = this.gameState.powerUps.filter(powerUp => powerUp.type !== 'shield');
                    this.updatePowerUpIndicators();
                    return;
                }

                this.gameState.hearts--;
                this.gameState.timeSinceLastDamage = 0;
                this.updateHealthBar();
                if (this.gameState.hearts <= 0) {
                    this.gameOver();
                } else {
                    if (this.gameState.chicken.powerUpCount > 0) {
                        this.gameState.chicken.powerUpCount--;
                        this.chicken.setScale(1);
                    }
                    if (this.gameState.soundOn) this.hitSound.play();
                    this.cameras.main.shake(200, 0.01);
                }
            }

            updateHealthBar() {
                this.healthBar.clear(true, true);
                for (let i = 0; i < this.gameState.hearts; i++) {
                    this.healthBar.create(this.cameras.main.width - 40 - i * 45, 40, 'heart');
                }
            }

            updatePowerUpIndicators() {
                this.powerUpIndicators.clear(true, true);
                this.gameState.powerUps.forEach((powerUp, index) => {
                    const indicator = this.add.image(this.cameras.main.width - 40, 100 + index * 50, powerUp.type);
                    const timeLeft = Math.max(0, powerUp.duration - (this.time.now - powerUp.startTime));
                    const timerBar = this.add.rectangle(indicator.x, indicator.y + 25, 40 * (timeLeft / powerUp.duration), 5, 0xffffff);
                    this.powerUpIndicators.add(indicator);
                    this.powerUpIndicators.add(timerBar);
                });
            }

            respawnPowerUp(powerUp) {
                powerUp.x = this.cameras.main.width + Phaser.Math.Between(100, 1000);
                powerUp.y = Phaser.Math.Between(100, this.cameras.main.height - 200);
            }

            shootProjectile() {
                if (Math.random() < 0.5) {
                    const projectile = this.physics.add.image(this.enemy.x + this.enemy.width / 2, this.enemy.y, 'projectile');
                    projectile.setVelocityX(400);
                    this.physics.add.overlap(this.chicken, projectile, this.damageChicken, null, this);
                    if (this.gameState.soundOn) this.projectileSound.play();
                }
            }

            gameOver() {
                this.gameState.gameOver = true;
                this.scene.pause();
                // Show game over menu
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 300 },
                    debug: false
                }
            },
            scene: ChickenChaseGame
        };

        new Phaser.Game(config);
    </script>
</body>
</html>
